service: defender
configValidationMode: error
frameworkVersion: '3'

provider:
  name: defender
  stage: ${opt:stage, 'dev'}
  stackName: 'bumpers'
  # SSOT: use this template as a single source of truth. 
  #Â This will delete Defender resources (with the exception of Relayers) not found in this template upon deployment.
  ssot: false

defender:
  key: "${env:TEAM_API_KEY}"
  secret: "${env:TEAM_API_SECRET}"

functions:
  autotask-polygon:
    name: 'Bump relayer fees on Polygon'
    # where the index file is located
    path: './dist/polygon'
    relayer: ${self:resources.Resources.relayers.bumper-polygon}
    trigger:
      type: webhook
    paused: false
  autotask-optimism:
    name: 'Bump relayer fees on Optimism'
    # where the index file is located
    path: './dist/optimism'
    relayer: ${self:resources.Resources.relayers.bumper-optimism}
    trigger:
      type: webhook
    paused: false

resources:
  Resources:
    policies:
      policy-1:
        eip1559-pricing: true
        private-transactions: true

    relayers:
      bumper-polygon:
        name: Bumper Polygon
        # list of networks can be found at:
        # https://github.com/OpenZeppelin/defender-serverless/blob/main/src/types/docs/definitions-definitions-network.md
        network: matic
        min-balance: 1000
        policy: ${self:resources.Resources.policies.policy-1}
        api-keys:
          - key1
      bumper-optimism:
        name: Bumper Optimism
        # list of networks can be found at:
        # https://github.com/OpenZeppelin/defender-serverless/blob/main/src/types/docs/definitions-definitions-network.md
        network: optimism
        min-balance: 1000
        policy: ${self:resources.Resources.policies.policy-1}
        api-keys:
          - key1
    #sentinels:
      #watcher-polygon:
        #name: Watcher Polygon
        #type: BLOCK
        #network: matic
        #addresses:
          #- '0x403b1E6EFB00C440dDb60593255c1257f4156863'
        #paused: false
        #autotask-condition: ${self:functions.autotask-polygon}
        #autotask-trigger: ${self:functions.autotask-polygon}
        #confirm-level: 1
        #notify-config:
          #channels: []
        #conditions:
          #event:
            #- expression: null
              #signature: XCalled(bytes32,address,address,uint256,address,uint256,bytes)
plugins:
  - defender-serverless
